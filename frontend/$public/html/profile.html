<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        />
        <link href="./css/profile.css" rel="stylesheet" />
        <title>User Profile</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>
    <script>
        $(document).ready(function () {
            var userData = localStorage.getItem('userData');
            userData = JSON.parse(userData);
            var username = userData[0].username;
            var email = userData[0].email;
            var pic = userData[0].pic;
            var userid = userData[0].userid;

            $('#username').val(username);
            $('#email').val(email);
            $('#role').val(role);

            $('profilepic').attr('src', 'http://localhost:8081/image/' + pic);

            $('#Update').click(function () {
                var username = $('#username').val();
                var role = $('#role').val();
                var email = $('#email').val();

                var jwt = localStorage.getItem('JWT');

                var data = `{"email":"${email}", "password": "${pwd}"}`;

                console.log(data);

                $.ajax({
                    headers: { authorisation: `Bearer ${jwt}` },
                    url: 'http://localhost:8081/user',
                    method: 'PUT',
                    contentType: 'application/json',
                    dataType: 'application/json',
                    data: data,
                    success: function (result, status, xhr) {
                        console.log(result);
                        if (result && result.success) {
                            var userData = localStorage.getItem('userData');
                            userData = Json.parse(userData);
                            userData[0].username = username;
                            localStorage.setItem(
                                'userData',
                                JSON.stringify(userData)
                            );

                            $('#msg').html('Profile Update successfully!');
                        }
                    },
                    error: function (xhr, status, error) {},
                });
            });
        });
    </script>
    <body>
        <div class="card">
            <img
                src="http://localhost:3001/profile.jpg"
                id="profilepic"
                alt="Profile"
                style="width: 100%"
            />
            <p class="username">
                <label>Username: </label> <input type="text" id="username" />
            </p>
            <p class="role">
                <label>Job role: </label> <input type="text" id="role" />
            </p>
            <p class="email">
                <label>Email: </label> <input type="text" id="email" />
            </p>
            <p><span id="msg"></span></p>
            <a href="#"><i class="fa fa-dribbble"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-linkedin"></i></a>
            <a href="#"><i class="fa fa-facebook"></i></a>
            <p><input type="button" id="Update" value="Update Profile" /></p>
            <p><input type="button" id="Logout" value="Log Out" /></p>
        </div>
    </body>
</html>
